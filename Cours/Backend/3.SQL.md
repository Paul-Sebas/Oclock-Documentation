# SQL

Avec PSQL

Notez le `;` à la fin de chaque commande.


## Quelques commandes basiques de psql

> `\q`             -- quitter
> 
> `\l`             -- lister les bases de données
> 
> `\du`            -- lister les rôles
> 
> `\dt`            -- lister les tables (relations)
> 
> `\d student`     -- décrire la table student
> 
> `\i data.sql`    -- importer un fichier SQL
> 
> `\o data.sql`    -- exporter un fichier SQL
> 
> `\c trombi`      -- se connecter à la base de données 'trombi'


## Quelques requetes SQL

DOC générale : https://sql.sh/

**Pas obligatoire dans la syntaxe SQL mais conventionnel :**
- les mots clés en majuscules
- les noms de tables et de colonnes entre guillemets double
- les valeurs entre guillemets simples


```sql
-- select standards
SELECT * FROM "student"; -- afficher tous les étudiants
SELECT * FROM "promo"; -- afficher toutes les promos
SELECT "first_name" FROM "student"; -- afficher seulement les prénoms des étudiants
SELECT * FROM "student" LIMIT 5; -- afficher les 5 premiers étudiants

-- select avec tri
SELECT * FROM "student" ORDER BY "last_name" ASC LIMIT 10; -- afficher les 10 premiers étudiants triés par nom de famille en ordre croissant
SELECT * FROM "promo" ORDER BY "name" ASC; -- afficher les promos triées par nom en ordre décroissant

-- select avec critères
SELECT * FROM "student" WHERE "id" = 42; -- afficher l'étudiant avec l'id 42
SELECT * FROM "promo" WHERE "name" = 'Pizza'; -- afficher la promo Pizza
SELECT * FROM "student" WHERE "first_name" = 'John'; -- afficher les étudiants qui s'appellent John
SELECT "name" FROM "promo" WHERE "name" LIKE 'P%'; -- afficher les noms de promos qui commencent par P
SELECT "name" FROM "promo" WHERE "name" LIKE '%a' OR "name" LIKE '%o'; -- afficher les noms de promos qui finissent par a ou o
```


```sql
-- afficher les étudiants avec le nom de leur promo
SELECT 
  "student"."first_name",
  "promo"."name"
FROM
  "student",
  "promo"
WHERE
  "student"."promo_id" = "promo"."id";
```


```sql
-- renommer les colonnes pour plus de clarté
SELECT 
  "first_name" AS "Prénom",
  "last_name" AS "Nom"
FROM
  "student";
```

## Bonus : Quelques fonctions SQL
```sql
-- count
SELECT COUNT(*) FROM "promo"; -- afficher le nombre de promos
SELECT COUNT(*) AS "Nombre d'étudiants" FROM "student"; -- afficher le nombre d'étudiants

-- compter le nombre d'étudiants par promo
SELECT 
  "promo"."name",
  COUNT("student"."id")
FROM
  "student",
  "promo"
WHERE
  "student"."promo_id" = "promo"."id"
GROUP BY
  "promo"."name";

-- concaténation
SELECT 
  CONCAT("first_name", ' ', "last_name") AS "Etudiant"
FROM
  "student"
LIMIT 15;
```	