# Prisma ORM

## 1. Quâ€™est-ce que Prisma ORM et sa philosophie

ğŸ“˜ Doc liÃ©e :

ğŸ‘‰ What is Prisma

<https://www.prisma.io/docs/orm/overview/introduction/what-is-prisma>

### DÃ©finition simple

Prisma est un ORM moderne pour Node.js et TypeScript, centrÃ© sur :

- un schÃ©ma explicite (Prisma Schema),
- une gÃ©nÃ©ration automatique de client typÃ©,
- une excellente intÃ©gration avec TypeScript.

    > ğŸ‘‰ Prisma nâ€™est pas seulement un ORM :
    >
    > câ€™est un **toolkit** composÃ© de plusieurs briques.

### Les 3 briques principales de Prisma

1. Prisma Schema

    â†’ dÃ©crit ta base de donnÃ©es (tables, relations, types)

2. Prisma Client

    â†’ client TypeScript gÃ©nÃ©rÃ© automatiquement pour requÃªter la DB

3. Prisma Migrate

    â†’ systÃ¨me de migrations (Ã©volution du schÃ©ma)

ğŸ¯ Philosophie clÃ© :

> Ton schÃ©ma est la source de vÃ©ritÃ©, et Prisma gÃ©nÃ¨re le reste Ã  partir de lui.

---

## 2. Pourquoi utiliser Prisma (et quand câ€™est pertinent)

ğŸ“˜ Doc liÃ©e :

ğŸ‘‰ Why Prisma

<https://www.prisma.io/docs/orm/overview/introduction/why-prisma>

### Les bÃ©nÃ©fices principaux

âœ… Typage TypeScript ultra fort

- Les modÃ¨les Prisma deviennent des types TS automatiques
- AutocomplÃ©tion complÃ¨te dans lâ€™IDE
- Erreurs dÃ©tectÃ©es au moment du build, pas en prod

```typescript
// Prisma sait exactement ce que contient un User
const user = await prisma.user.findUnique({
  where: { id: 1 },
})
```

â¡ï¸ Si `id` nâ€™existe pas â†’ erreur TypeScript immÃ©diate.

---

âœ… **LisibilitÃ© des requÃªtes**

Les requÃªtes Prisma sont :

- dÃ©claratives
- proches du mÃ©tier
- sans chaÃ®nes SQL cachÃ©es

---

âœ… **TrÃ¨s bon pour lâ€™apprentissage**

- Peu de magie implicite
- Tout est visible : schÃ©ma, relations, types
- Excellent pour comprendre comment une DB relationnelle fonctionne

---

### Quand Prisma est pertinent

âœ… API REST / GraphQL

âœ… Projets TypeScript

âœ… PostgreSQL, MySQL, SQLite

âœ… Ã‰quipes qui veulent de la **sÃ©curitÃ© de typage**

ğŸš« Moins pertinent si :

- projet JS pur sans TS
- SQL trÃ¨s spÃ©cifique / exotique
- besoin dâ€™un ORM ultra dynamique Ã  runtime

---

## 3. Prisma vs Sequelize (comparaison conceptuelle)

| Concept                       | Sequelize | Prisma           |
| ----------------------------- | --------- | ---------------- |
| DÃ©finition des modÃ¨les        | JS/TS     | Prisma Schema    |
| Source de vÃ©ritÃ©              | Code      | SchÃ©ma           |
| Typage TS                     | Partiel   | Natif et fort    |
| Migrations                    | SÃ©parÃ©es  | IntÃ©grÃ©es        |
| RequÃªtes                      | ChaÃ®nÃ©es  | Objet dÃ©claratif |

### Exemple mental

- Sequelize :

    > Â« Jâ€™Ã©cris mes modÃ¨les, puis jâ€™essaie de typer autour Â»

- Prisma :

    > Â« Je dÃ©cris mon schÃ©ma, Prisma gÃ©nÃ¨re le client typÃ© Â»

ğŸ‘‰ Prisma est **schema-first**, Sequelize est **code-first**.

---

## 4. Installation de Prisma avec TypeScript + PostgreSQL

ğŸ“˜ Docs liÃ©es :

- <https://www.prisma.io/docs/orm/getting-started>
- <https://www.prisma.io/docs/orm/overview/databases/postgresql>

### Ã‰tape 1 : dÃ©pendances

```bash
npm install prisma --save-dev
npm install @prisma/client
```

- prisma â†’ CLI + migrations

- @prisma/client â†’ client gÃ©nÃ©rÃ©

---

### Ã‰tape 2 : initialisation

```bash
npx prisma init
```

ğŸ‘‰ CrÃ©e :

```bash
prisma/
 â””â”€â”€ schema.prisma
.env
```

---

### Ã‰tape 3 : connexion PostgreSQL

Dans `.env` :

```env
DATABASE_URL="postgresql://user:password@localhost:5432/mydb"
```

---

## 5. Le Prisma Schema (coeur du systÃ¨me)

ğŸ“˜ Doc liÃ©e :

ğŸ‘‰ <https://www.prisma.io/docs/orm/prisma-schema/overview>

Le fichier `schema.prisma` contient 3 blocs principaux.

---

### 5.1 Datasource (connexion DB)

```prisma
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}
```

â¡ï¸ Ã‰quivalent conceptuel :

- Sequelize : config dans `sequelize.config.js`

---

### 5.2 Generator (Prisma Client)

```prisma
generator client {
  provider = "prisma-client-js"
}
```

ğŸ‘‰ Dit Ã  Prisma :

> Â« GÃ©nÃ¨re un client TypeScript Ã  partir de ce schÃ©ma Â»

---

### 5.3 Models (tables)

```prisma
model User {
  id    Int     @id @default(autoincrement())
  email String  @unique
  name  String?
}
```

#### Lecture simple

- `User` â†’ table
- `String?` â†’ nullable (optionnel)
- `@id` â†’ clÃ© primaire
- `@unique` â†’ contrainte SQL

---

### 5.4 Relations

```prisma
model Post {
  id     Int    @id @default(autoincrement())
  title  String
  userId Int
  user   User   @relation(fields: [userId], references: [id])
}
```

â¡ï¸ Prisma force une **relation explicite et claire**

(plus strict que Sequelize, mais plus sÃ»r)

---

## 6. Prisma Client

ğŸ“˜ Doc liÃ©e :

ğŸ‘‰ <https://www.prisma.io/docs/orm/prisma-client/queries/crud>

### 6.1 GÃ©nÃ©ration

```bash
npx prisma generate
```

â¡ï¸ GÃ©nÃ¨re un client TS basÃ© sur le schÃ©ma

---

### 6.2 Instanciation

```typescript
import { PrismaClient } from '@prisma/client'

const prisma = new PrismaClient()
```

ğŸ‘‰ `prisma.user`, `prisma.post`, etc.

â¡ï¸ Chaque modÃ¨le devient une API typÃ©e.

---

### 6.3 Typage automatique

```typescript
prisma.user.create({
  data: {
    email: "test@mail.com",
    name: "Alice"
  }
})
```

- champs obligatoires imposÃ©s
- types vÃ©rifiÃ©s
- erreurs avant exÃ©cution

---

## 7. Prisma dans une API Express

```typescript
import express from "express"
import { PrismaClient } from "@prisma/client"

const app = express()
const prisma = new PrismaClient()

app.use(express.json())

app.get("/users", async (req, res) => {
  const users = await prisma.user.findMany()
  res.json(users)
})
```

ğŸ‘‰ Simple, lisible, fortement typÃ©.

---

## 8. OpÃ©rations courantes

### CRUD

```typescript
// Create
await prisma.user.create({ data: { email: "a@a.com" } })

// Read
await prisma.user.findMany()

// Update
await prisma.user.update({
  where: { id: 1 },
  data: { name: "Bob" }
})

// Delete
await prisma.user.delete({ where: { id: 1 } })
```

---

### Relations

```typescript
await prisma.user.findMany({
  include: {
    posts: true
  }
})
```

â¡ï¸ TrÃ¨s lisible comparÃ© aux include Sequelize imbriquÃ©s.

---

### Filtrage & pagination (concept)

```typescript
await prisma.user.findMany({
  where: { email: { contains: "@gmail.com" } },
  skip: 10,  // nombre d'Ã©lÃ©ments Ã  ignorer (offset)
  take: 5   // nombre d'Ã©lÃ©ments Ã  prendre (limit)
})
```

---

## 9. Les migrations

ğŸ“˜ Doc liÃ©e :

ğŸ‘‰ <https://www.prisma.io/docs/orm/prisma-migrate>

```bash
npx prisma migrate dev --name init
```

ğŸ‘‰ Prisma :

- compare le schÃ©ma
- gÃ©nÃ¨re le SQL
- applique la migration
- met Ã  jour la DB

â¡ï¸ Plus intÃ©grÃ© que Sequelize CLI.

---

## 10. Bonnes pratiques pour bien dÃ©buter

âœ… Toujours modifier le schema.prisma, pas la DB Ã  la main

âœ… Une instance Prisma par application (pas de new PrismaClient() Ã  chaque requÃªte)

âœ… Fermer la connexion proprement en prod

âœ… Lire les erreurs Prisma : elles sont trÃ¨s explicites

âœ… Penser schÃ©ma â†’ client â†’ code

---

ğŸ§  En rÃ©sumÃ© mental

Prisma =

**SchÃ©ma clair** â†’ **Client TS gÃ©nÃ©rÃ©** â†’ **RequÃªtes sÃ»res**
